# Работа с CSS и JavaScript в Drupal 8

Эта статья значительно расширяет один из разделов поста «[Что нового в темах Drupal 8](http://www.master-web.info/whats-new-in-drupal-8-themes/)», в котором я лишь вскользь упомянул о библиотеках для управления стилями и скриптами в темах. Однако, это новшество в Drupal 8 стоит того, чтобы его рассмотреть более детально.

В этом посте мы более подробно остановимся на вопросах создания и работы с библиотеками: управлением зависимостями, подключением сторонних библиотек, переопределением, удалением или отключением ненужных библиотек.

<!--More-->

## Создание библиотек

В восьмой версии Drupal фалы стилей и скриптов добаловаться в темы уже совершенно по-новому. Для того, чтобы добавить CSS или JavaScript вам нужно определить их в файле библиотек `mytheme.libraries.yml`, который должен находиться в корневой директории вашей темы.

Каждая библиотека должна иметь уникальное, в рамках темы, имя; может иметь произвольное количество загружаемых файлов, перечень зависимостей, а также дополнительную информацию нужную для библиотеки.

Давайте посмотрим на такой пример:

```yml
# Файл my_theme.libraries.yml

# Задаем имя библиотеки.
my-library-name:
  version: "1.0.x"
  css:
    # учитываем категории согласно SMACSS методологии.
    base:
      # Путь к фалу CSS.
      assets/css/base.css: {}
    theme:
      assets/css/print.css: { media: print }
  js:
    assets/js/myglobal.js {}
  dependencies:
    - core/jquery

# А здесь мы добавим шрифт от Google font.
lato:
  css:
    base: '//fonts.googleapis.com/css?family=Lato': { external: true }
```

Стоит отметить, что файлы в формате `.yml` используются для вех конфигурационных файлов в Drupal 8.

### Имя библиотеки

Как я уже упомянул выше мы должны задать уникальное имя для нашей библиотеке в контексте темы или модуля, которые вызывают библиотеку.

### Версия

Не обязательно задавать версию для библиотеки, но лучше сделать это. В дальнейшем, вам будет легче поддерживать код. Особенно важно добавлять версию для внешних библиотек, согласно версии источника.

### CSS

Все CSS файлы библиотеки описываются вложенными внутрь секции `css`, кроме того, их можно разделить на под-категории. Например:

```yml
css:
  # учитываем категории согласно SMACSS методологии.
  base:
    # Путь к фалу CSS.
    assets/css/base.css: {}
  theme:
    assets/css/print.css: { media: print }
```

В этом отрывке кода каждый файл указан в свое под-категории. Для того, чтобы детальнее познакомиться с принципами организации CSS, стоить посмотреть в [документации по организации CSS Drupal](https://www.drupal.org/node/1887922). Вкратце скажем, что Друпал использует SMACSS методологии организации файлов стилей. Все файлы условно разбиваться на под-категории: `base`, `layout`, `component`, `state`, и `theme`. Примечательно то, что независимо от библиотек, файлы стилей подключаются на странице именно в порядке следования этих под-категорий. То есть, файл из секции `base` одной библиотеки будет загружаться совместно с файлом из этой секции другой библиотеки.

### Дополнительные свойства

Дополнительные свойства для CSS файлов могут быть заданы с помощью фигурных скобок после пути к файлу:

```yml
theme:
  assets/css/print.css: { media: print }
```

Здесь мы передаем кастомные медиа-свойства для файла, в данном случае это `print`, но мы можем задать и другие медиа-свойства, например установить значения минимальной или максимальной ширины, к которой будут применены правила файла.

### JavaScript

Файлы `.js` добавляются в секции `js`. Для них нет какой-либо дополнительной структуры, но вы можете добавить кастомные свойства в фигурных скобках после пути файла. Например, вы можете указать значение `minified: true`, чтобы Drupal минифицировал данный файл при агрегации. Также, перед именем фала вы можете указать регион страницы, куда будет загружен файл. По умолчанию Drupal 8 загружает все скрипты в нижнюю часть страницы, но если вам нужно поместить скрипт в верх, то можно указать `header: true` и скрипт будет помещен в `head` документа. Вот пример подключения `.js` файла к библиотеке:

```yml
js-header:
  header: true
  js:
    header.js: { minified: true }

js-footer:
  js:
    footer.js: { minified: true }
```

### Зависимости

Здесь все просто. В конце определения вашей библиотеки вы можете добавить секцию, в которой укажите от каких библиотек она зависит и эта библиотека тоже будет добавлена вместе с вашей. Важно, чтобы эта библиотека существовала, и вы правильно указали бы ее имя и путь. Например:

```yml
# ... код библиотеки
# Объявляем зависимости.
dependencies:
  - core/jquery
```

В данном случае мы объявили зависимость от библиотеки `jquery`, которая была определена модулем `core` в его файле библиотек `core.libraries.yml`.

### Внешние файлы

Добавить внешний файл в библиотеку очень просто: укажите полный путь к файлу, а в дополнительных свойствах обязательно скажите, что файл внешний `{ external: true }`. Мы уже добавляли таким образом шрифт в коде в начале поста:

```yml
# ... код библиотеки
# А здесь мы добавим шрифт от Google font.
lato:
  css:
    base:
      '//fonts.googleapis.com/css?family=Lato': { external: true }
```

## Прикрепляем библиотеки

Если вы просто перечислите ваши библиотеки в `mytheme.libraries.yml`, то ничего особенного не произойдет. Чтобы Drupal знал, что о ваших библиотеках, нужно сказать ему какие и как использовать. У вас есть три способа вызова библиотек: подключить библиотеку глобально через `mytheme.info.yml`, вызвать библиотеку из Twig-шаблона, а также добавить ее через препроцесс-хук. Рассмотри все три способа детальнее.

### Прикрепляем библиотеку глобально

В разделе библиотек просто укажите пути и имена библиотек, которые хотите использовать всюду на сайте. Например:

```yml
libraries:
  - core/normalize
  - mythemename/my-library-name
```

### Прикрепляем библиотеку к файлу шаблона

Лично мне эта возможность очень нравиться, она позволяет реализовать действительно компонентный подход при разработке тем Drupal 8. В Twig-шаблонах предусмотрена специальная функция `attach_library()`, которая будет вызывать файлы библиотеки только в том случае, если блок, который использует этот шаблон будет выведен на странице. То есть, вы значительно уменьшаете размер загружаемого кода, используете только то, что вам нужно и когда это нужно. Например:

```yml
{# В файле Twig-шаблона node--article--full.html.twig. #}

{{ attach_library('mythemename/my-library-name') }}
```
Файлы библиотеки буду загружены только на страницах полного вида нод типа `article`. Просо супер!

### Добавляем библиотеку через препроцесс-хук

Для бэк-энд разработчиков, возможно, привычнее будет добавлять библиотеки через PHP. Например:

```php
function mytheme_preprocess_maintenance_page(&$variables) {
  $variables['#attached']['library'][] = 'mytheme/cuddly-slider';
}
```

Вы можете использовать любые хуки и логику, главное — это добавить свою библиотеку к массиву `['library']`.



